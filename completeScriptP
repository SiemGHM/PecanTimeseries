#!/bin/bash



set -e

# Function to display messages
log() {
	    echo -e "\033[1;32m$1\033[0m"
    }

log "Verifying Conda installation..."
if ! command -v conda &> /dev/null; then
	    echo "Error: Conda installation failed."
	        exit 1
fi
conda --version

# Step 6: Create a New Conda Environment
ENV_NAME="pytorch_env"
PYTHON_VERSION="3.9"
log "Creating Conda environment: $ENV_NAME with Python $PYTHON_VERSION..."
conda create -n $ENV_NAME python=$PYTHON_VERSION -y

# Step 7: Activate the Environment
log "Activating Conda environment: $ENV_NAME..."
source activate $ENV_NAME

# Step 8: Install Required Packages
log "Installing PyTorch (with CUDA), NumPy, and Pandas..."
#conda install pytorch torchvision torchaudio pytorch-cuda=11.8 -c pytorch -c nvidia -y
#conda install numpy pandas -y
pip install torch torchvision torchaudio --extra-index-url https://download.pytorch.org/whl/cu124
pip install numpy pandas 




# Step 9: Verify PyTorch Installation
log "Verifying PyTorch installation..."
python -c "import torch; print('PyTorch version:', torch.__version__); print('CUDA available:', torch.cuda.is_available())"
nvidia-smi
pip install tqdm numpy matplotlib pandas scikit-learn pynvml sentencepiece transformers protobuf google
pip install reformer-pytorch accelerate
pip install --upgrade huggingface_hub

# Step 10: Run ddpTorch.sh
SCRIPT_NAME="runScript.sh"
if [ -f "$SCRIPT_NAME" ]; then
	    log "Running $SCRIPT_NAME..."
	        chmod +x $SCRIPT_NAME
		    ./$SCRIPT_NAME
		        #python patchtst_pretrain.py --dset custom --mask_ratio 0.4
		else
			    echo "Error: $SCRIPT_NAME not found in the current directory."
			        exit 1
fi

log "Setup process complete!"
